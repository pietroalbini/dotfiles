#!/bin/bash
set -euo pipefail
IFS=$'\n\t'

REMOTE_HOST="winter.net.pietroalbini.org"
REMOTE_PORT="9898"
URL="https://pipe.me.pietroalbini.org/"

if [[ "$#" -ne 1 ]]; then
    echo "Usage: $0 <port>" >&2
    exit 1
fi

ssh -R "${REMOTE_PORT}:127.0.0.1:$1" "${REMOTE_HOST}" bash - << EOF
echo You can view local content at ${URL}
while true; do
    sleep 600
done
EOF
